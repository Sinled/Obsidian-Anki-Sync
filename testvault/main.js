'use strict';

var obsidian = require('obsidian');

class Block {
    constructor(vault, file) {
        this.vault = vault;
        this.file = file;
    }
}

function getAttrib(comment, attribute) {
    const CommentsRegExp = /<!--((\n|.)*?)-->/gi; // https://regexr.com/5tatm
    let matches = [...comment.matchAll(CommentsRegExp)];
    let parser = new DOMParser();
    let xmlStatement = parser.parseFromString("<" + matches[0][1].trim() + " />", "text/xml");
    return xmlStatement.getRootNode().children[0].getAttribute(attribute);
    // 
}

class ClozeBlock extends Block {
    constructor(vault, file, original, original_start_at, original_end_at) {
        super(vault, file);
        this.original = original;
        this.original_start_at = original_start_at;
        this.original_end_at = original_end_at;
    }
    mdToAnkiFormat() {
        this.anki = this.original;
        // -- Preprocess --
        // TODO: Images?
        // Remove All Comments
        const CommentsRegExp = /<!--((\n|.)*?)-->/gi; // https://regexr.com/5tatm
        this.anki = this.anki.replaceAll(CommentsRegExp, "");
        // Add the clozes
        const ClozeStatementRegExp = /<!--(\t|\n| )*?cloze((\n| (\n|.)*?)*?) -->/gi; // https://regexr.com/5tb31
        let matches = [...this.original.matchAll(ClozeStatementRegExp)];
        matches.forEach((match) => {
            console.log(match[0]);
            let clozeId = getAttrib(match[0], "id");
            let clozeText = getAttrib(match[0], "text");
            let n = getAttrib(match[0], "n") || "All";
            if (n == "All") {
                this.anki = this.anki.replaceAll(clozeText, `{{c${clozeId}::${clozeText}}}`);
            }
            else {
                let i = 0;
                this.anki = this.anki.replace(clozeText, function (match) {
                    return (i++ == n) ? `{{c${clozeId}::${clozeText}}}` : match;
                });
            }
        });
        // Fix Latex format
        const MdInlineMathRegExp = /(?<!\$)\$((?=[\S])(?=[^$])[\s\S]*?\S)\$/g; // https://github.com/Pseudonium/Obsidian_to_Anki/blob/488454f3c39a64bd0381f490c20f47866a3e3a3d/src/constants.ts
        const MdDisplayMathRegExp = /\$\$([\s\S]*?)\$\$/g; // https://github.com/Pseudonium/Obsidian_to_Anki/blob/488454f3c39a64bd0381f490c20f47866a3e3a3d/src/constants.ts
        this.anki = this.anki.replace(MdInlineMathRegExp, function (match) {
            return `\( ${match[1]} \)`;
        });
        this.anki = this.anki.replace(MdDisplayMathRegExp, function (match) {
            return `\( ${match[1]} \)`;
        });
        // Convert Md to HTML format
    }
}
async function parseClozeBlock(vault, file) {
    var res = [];
    const ClozeBlockRegExp = /<!--(\t|\n| )*?clozeblock-start(\n| (\n|.)*?)*?-->(\n|.)*?<!--(\t|\n| )*?clozeblock-end(\t|\n| )*?-->/gi; // https://regexr.com/5tace
    var fileContent = await vault.read(file);
    let matches = [...fileContent.matchAll(ClozeBlockRegExp)];
    matches.forEach((match) => {
        var block = new ClozeBlock(vault, file, match[0], match.index, match[0].length);
        res.push(block);
    });
    return res;
}

class MyPlugin extends obsidian.Plugin {
    async onload() {
        console.log('Loading ObsidianCMuToAnki');
        // Add ribbon for syncing obsidian to anki
        const ANKI_ICON = `<path fill="currentColor" stroke="currentColor" d="M 27.00,3.53 C 18.43,6.28 16.05,10.38 16.00,19.00 16.00,19.00 16.00,80.00 16.00,80.00 16.00,82.44 15.87,85.73 16.74,88.00 20.66,98.22 32.23,97.00 41.00,97.00 41.00,97.00 69.00,97.00 69.00,97.00 76.63,96.99 82.81,95.84 86.35,88.00 88.64,82.94 88.00,72.79 88.00,67.00 88.00,67.00 88.00,24.00 88.00,24.00 87.99,16.51 87.72,10.42 80.98,5.65 76.04,2.15 69.73,3.00 64.00,3.00 64.00,3.00 27.00,3.53 27.00,3.53 Z M 68.89,15.71 C 74.04,15.96 71.96,19.20 74.01,22.68 74.01,22.68 76.72,25.74 76.72,25.74 80.91,30.85 74.53,31.03 71.92,34.29 70.70,35.81 70.05,38.73 67.81,39.09 65.64,39.43 63.83,37.03 61.83,36.00 59.14,34.63 56.30,35.24 55.08,33.40 53.56,31.11 56.11,28.55 56.20,25.00 56.24,23.28 55.32,20.97 56.20,19.35 57.67,16.66 60.89,18.51 64.00,17.71 64.00,17.71 68.89,15.71 68.89,15.71 Z M 43.06,43.86 C 49.81,45.71 48.65,51.49 53.21,53.94 56.13,55.51 59.53,53.51 62.94,54.44 64.83,54.96 66.30,56.05 66.54,58.11 67.10,62.74 60.87,66.31 60.69,71.00 60.57,74.03 64.97,81.26 61.40,83.96 57.63,86.82 51.36,80.81 47.00,82.22 43.96,83.20 40.23,88.11 36.11,87.55 29.79,86.71 33.95,77.99 32.40,74.18 30.78,70.20 24.67,68.95 23.17,64.97 22.34,62.79 23.39,61.30 25.15,60.09 28.29,57.92 32.74,58.49 35.44,55.57 39.11,51.60 36.60,45.74 43.06,43.86 Z" />`;
        obsidian.addIcon('anki', ANKI_ICON);
        this.addRibbonIcon('anki', 'Sync Obsidian to Anki', () => {
            this.syncObsidianToAnki();
        });
        // Add command for syncing obsidian to anki
        this.addCommand({
            id: 'sync-obsidian-to-anki',
            name: 'Sync Obsidian to Anki',
            callback: () => {
                this.syncObsidianToAnki();
            }
        });
    }
    onunload() {
        console.log('Unloading ObsidianAnkiMDML');
    }
    async syncObsidianToAnki() {
        new obsidian.Notice(`Starting Obsidian to Anki Sync for vault ${this.app.vault.getName()}...`);
        // Add
        var allClozeBlocks = [];
        for (var file of this.app.vault.getMarkdownFiles()) {
            allClozeBlocks = allClozeBlocks.concat(await parseClozeBlock(this.app.vault, file));
        }
        console.log(allClozeBlocks);
        for (var block of allClozeBlocks) {
            block.mdToAnkiFormat();
        }
        console.log(allClozeBlocks);
        // Create or update the cards
        // Delete the deleted cards
    }
}

module.exports = MyPlugin;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXMiOlsiLi4vc3JjL2Jsb2NrLnRzIiwiLi4vc3JjL3V0aWxzLnRzIiwiLi4vc3JjL2Nsb3plYmxvY2sudHMiLCIuLi9zcmMvbWFpbi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBURmlsZSwgVmF1bHQgfSBmcm9tICdvYnNpZGlhbic7XHJcblxyXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgQmxvY2sge1xyXG4gICAgdmF1bHQ6IFZhdWx0O1xyXG4gICAgZmlsZTogVEZpbGU7XHJcbiAgICBhYnN0cmFjdCBvcmlnaW5hbDogU3RyaW5nO1xyXG4gICAgYWJzdHJhY3Qgb3JpZ2luYWxfc3RhcnRfYXQ6IE51bWJlcjtcclxuICAgIGFic3RyYWN0IG9yaWdpbmFsX2VuZF9hdDogTnVtYmVyO1xyXG4gICAgYWJzdHJhY3QgYW5raTogU3RyaW5nO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHZhdWx0OiBWYXVsdCwgZmlsZTogVEZpbGUpIHtcclxuICAgICAgICB0aGlzLnZhdWx0ID0gdmF1bHQ7XHJcbiAgICAgICAgdGhpcy5maWxlID0gZmlsZTtcclxuICAgIH1cclxuXHJcbiAgICBhYnN0cmFjdCBtZFRvQW5raUZvcm1hdCgpOiB2b2lkO1xyXG59IiwiZXhwb3J0IGZ1bmN0aW9uIGdldEF0dHJpYihjb21tZW50OiBTdHJpbmcsIGF0dHJpYnV0ZTogU3RyaW5nKSB7XHJcbiAgICBjb25zdCBDb21tZW50c1JlZ0V4cDpSZWdFeHAgPSAvPCEtLSgoXFxufC4pKj8pLS0+L2dpIC8vIGh0dHBzOi8vcmVnZXhyLmNvbS81dGF0bVxyXG4gICAgbGV0IG1hdGNoZXMgPSBbLi4uY29tbWVudC5tYXRjaEFsbChDb21tZW50c1JlZ0V4cCldO1xyXG4gICAgbGV0IHBhcnNlciA9IG5ldyBET01QYXJzZXIoKTtcclxuICAgIGxldCB4bWxTdGF0ZW1lbnQgPSBwYXJzZXIucGFyc2VGcm9tU3RyaW5nKFwiPFwiK21hdGNoZXNbMF1bMV0udHJpbSgpK1wiIC8+XCIsXCJ0ZXh0L3htbFwiKTtcclxuICAgIHJldHVybiB4bWxTdGF0ZW1lbnQuZ2V0Um9vdE5vZGUoKS5jaGlsZHJlblswXS5nZXRBdHRyaWJ1dGUoYXR0cmlidXRlKTtcclxuICAgIC8vIFxyXG59IiwiaW1wb3J0IHsgQmxvY2sgfSBmcm9tIFwiLi9ibG9ja1wiO1xyXG5pbXBvcnQgeyBURmlsZSwgVmF1bHQgfSBmcm9tICdvYnNpZGlhbic7XHJcbmltcG9ydCB7IGdldEF0dHJpYiB9IGZyb20gJy4vdXRpbHMnXHJcblxyXG5leHBvcnQgY2xhc3MgQ2xvemVCbG9jayBleHRlbmRzIEJsb2NrIHtcclxuICAgIHZhdWx0OiBWYXVsdDtcclxuICAgIGZpbGU6IFRGaWxlO1xyXG4gICAgb3JpZ2luYWw6IFN0cmluZztcclxuICAgIG9yaWdpbmFsX3N0YXJ0X2F0OiBOdW1iZXI7XHJcbiAgICBvcmlnaW5hbF9lbmRfYXQ6IE51bWJlcjtcclxuICAgIGFua2k6IFN0cmluZ1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHZhdWx0OiBWYXVsdCwgZmlsZTogVEZpbGUsIG9yaWdpbmFsOiBTdHJpbmcsIG9yaWdpbmFsX3N0YXJ0X2F0OiBOdW1iZXIsIG9yaWdpbmFsX2VuZF9hdDogTnVtYmVyKSB7XHJcbiAgICAgICAgc3VwZXIodmF1bHQsIGZpbGUpO1xyXG4gICAgICAgIHRoaXMub3JpZ2luYWwgPSBvcmlnaW5hbDtcclxuICAgICAgICB0aGlzLm9yaWdpbmFsX3N0YXJ0X2F0ID0gb3JpZ2luYWxfc3RhcnRfYXQ7XHJcbiAgICAgICAgdGhpcy5vcmlnaW5hbF9lbmRfYXQgPSBvcmlnaW5hbF9lbmRfYXQ7XHJcbiAgICB9XHJcblxyXG4gICAgbWRUb0Fua2lGb3JtYXQoKSB7XHJcbiAgICAgICAgdGhpcy5hbmtpID0gdGhpcy5vcmlnaW5hbDtcclxuICAgICAgICAvLyAtLSBQcmVwcm9jZXNzIC0tXHJcbiAgICAgICAgLy8gVE9ETzogSW1hZ2VzP1xyXG4gICAgICAgIC8vIFJlbW92ZSBBbGwgQ29tbWVudHNcclxuICAgICAgICBjb25zdCBDb21tZW50c1JlZ0V4cDogUmVnRXhwID0gLzwhLS0oKFxcbnwuKSo/KS0tPi9naSAvLyBodHRwczovL3JlZ2V4ci5jb20vNXRhdG1cclxuICAgICAgICB0aGlzLmFua2kgPSB0aGlzLmFua2kucmVwbGFjZUFsbChDb21tZW50c1JlZ0V4cCwgXCJcIik7XHJcbiAgICAgICAgLy8gQWRkIHRoZSBjbG96ZXNcclxuICAgICAgICBjb25zdCBDbG96ZVN0YXRlbWVudFJlZ0V4cDogUmVnRXhwID0gLzwhLS0oXFx0fFxcbnwgKSo/Y2xvemUoKFxcbnwgKFxcbnwuKSo/KSo/KSAtLT4vZ2kgLy8gaHR0cHM6Ly9yZWdleHIuY29tLzV0YjMxXHJcbiAgICAgICAgbGV0IG1hdGNoZXMgPSBbLi4udGhpcy5vcmlnaW5hbC5tYXRjaEFsbChDbG96ZVN0YXRlbWVudFJlZ0V4cCldO1xyXG4gICAgICAgIG1hdGNoZXMuZm9yRWFjaCgobWF0Y2gpID0+IHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2cobWF0Y2hbMF0pO1xyXG4gICAgICAgICAgICBsZXQgY2xvemVJZCA9IGdldEF0dHJpYihtYXRjaFswXSwgXCJpZFwiKTtcclxuICAgICAgICAgICAgbGV0IGNsb3plVGV4dCA9IGdldEF0dHJpYihtYXRjaFswXSwgXCJ0ZXh0XCIpO1xyXG4gICAgICAgICAgICBsZXQgbiA9IGdldEF0dHJpYihtYXRjaFswXSwgXCJuXCIpIHx8IFwiQWxsXCI7XHJcbiAgICAgICAgICAgIGlmIChuID09IFwiQWxsXCIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuYW5raSA9IHRoaXMuYW5raS5yZXBsYWNlQWxsKGNsb3plVGV4dCwgYHt7YyR7Y2xvemVJZH06OiR7Y2xvemVUZXh0fX19YCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgaSA9IDA7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFua2kgPSB0aGlzLmFua2kucmVwbGFjZShjbG96ZVRleHQsIGZ1bmN0aW9uIChtYXRjaCkgeyAvLyBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy8xMDU4NDc0OC9maW5kLWFuZC1yZXBsYWNlLW50aC1vY2N1cnJlbmNlLW9mLWJyYWNrZXRlZC1leHByZXNzaW9uLWluLXN0cmluZy8xMDU4NTIzNFxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAoaSsrID09IG4pID8gYHt7YyR7Y2xvemVJZH06OiR7Y2xvemVUZXh0fX19YCA6IG1hdGNoO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gRml4IExhdGV4IGZvcm1hdFxyXG4gICAgICAgIGNvbnN0IE1kSW5saW5lTWF0aFJlZ0V4cDogUmVnRXhwID0gLyg/PCFcXCQpXFwkKCg/PVtcXFNdKSg/PVteJF0pW1xcc1xcU10qP1xcUylcXCQvZyAvLyBodHRwczovL2dpdGh1Yi5jb20vUHNldWRvbml1bS9PYnNpZGlhbl90b19BbmtpL2Jsb2IvNDg4NDU0ZjNjMzlhNjRiZDAzODFmNDkwYzIwZjQ3ODY2YTNlM2EzZC9zcmMvY29uc3RhbnRzLnRzXHJcbiAgICAgICAgY29uc3QgTWREaXNwbGF5TWF0aFJlZ0V4cDogUmVnRXhwID0gL1xcJFxcJChbXFxzXFxTXSo/KVxcJFxcJC9nIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9Qc2V1ZG9uaXVtL09ic2lkaWFuX3RvX0Fua2kvYmxvYi80ODg0NTRmM2MzOWE2NGJkMDM4MWY0OTBjMjBmNDc4NjZhM2UzYTNkL3NyYy9jb25zdGFudHMudHNcclxuICAgICAgICB0aGlzLmFua2kgPSB0aGlzLmFua2kucmVwbGFjZShNZElubGluZU1hdGhSZWdFeHAsIGZ1bmN0aW9uIChtYXRjaCkge1xyXG4gICAgICAgICAgICByZXR1cm4gYFxcKCAke21hdGNoWzFdfSBcXClgO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuYW5raSA9IHRoaXMuYW5raS5yZXBsYWNlKE1kRGlzcGxheU1hdGhSZWdFeHAsIGZ1bmN0aW9uIChtYXRjaCkge1xyXG4gICAgICAgICAgICByZXR1cm4gYFxcKCAke21hdGNoWzFdfSBcXClgO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIENvbnZlcnQgTWQgdG8gSFRNTCBmb3JtYXRcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHBhcnNlQ2xvemVCbG9jayh2YXVsdDogVmF1bHQsIGZpbGU6IFRGaWxlKTogUHJvbWlzZTxDbG96ZUJsb2NrW10+IHtcclxuICAgIHZhciByZXM6IENsb3plQmxvY2tbXSA9IFtdO1xyXG4gICAgY29uc3QgQ2xvemVCbG9ja1JlZ0V4cDogUmVnRXhwID0gLzwhLS0oXFx0fFxcbnwgKSo/Y2xvemVibG9jay1zdGFydChcXG58IChcXG58LikqPykqPy0tPihcXG58LikqPzwhLS0oXFx0fFxcbnwgKSo/Y2xvemVibG9jay1lbmQoXFx0fFxcbnwgKSo/LS0+L2dpIC8vIGh0dHBzOi8vcmVnZXhyLmNvbS81dGFjZVxyXG4gICAgdmFyIGZpbGVDb250ZW50ID0gYXdhaXQgdmF1bHQucmVhZChmaWxlKTtcclxuICAgIGxldCBtYXRjaGVzID0gWy4uLmZpbGVDb250ZW50Lm1hdGNoQWxsKENsb3plQmxvY2tSZWdFeHApXTtcclxuICAgIG1hdGNoZXMuZm9yRWFjaCgobWF0Y2gpID0+IHtcclxuICAgICAgICB2YXIgYmxvY2s6IENsb3plQmxvY2sgPSBuZXcgQ2xvemVCbG9jayh2YXVsdCwgZmlsZSwgbWF0Y2hbMF0sIG1hdGNoLmluZGV4LCBtYXRjaFswXS5sZW5ndGgpXHJcbiAgICAgICAgcmVzLnB1c2goYmxvY2spO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gcmVzO1xyXG59IiwiaW1wb3J0IHsgQXBwLCBOb3RpY2UsIFBsdWdpbiwgYWRkSWNvbiwgVEZpbGUgfSBmcm9tICdvYnNpZGlhbic7XHJcbmltcG9ydCB7IENsb3plQmxvY2ssIHBhcnNlQ2xvemVCbG9jayB9IGZyb20gJy4vY2xvemVibG9jayc7XHJcblxyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTXlQbHVnaW4gZXh0ZW5kcyBQbHVnaW4ge1xyXG5cdGFzeW5jIG9ubG9hZCgpIHtcclxuXHRcdGNvbnNvbGUubG9nKCdMb2FkaW5nIE9ic2lkaWFuQ011VG9BbmtpJyk7XHJcblxyXG5cdFx0Ly8gQWRkIHJpYmJvbiBmb3Igc3luY2luZyBvYnNpZGlhbiB0byBhbmtpXHJcblx0XHRjb25zdCBBTktJX0lDT046IHN0cmluZyA9IGA8cGF0aCBmaWxsPVwiY3VycmVudENvbG9yXCIgc3Ryb2tlPVwiY3VycmVudENvbG9yXCIgZD1cIk0gMjcuMDAsMy41MyBDIDE4LjQzLDYuMjggMTYuMDUsMTAuMzggMTYuMDAsMTkuMDAgMTYuMDAsMTkuMDAgMTYuMDAsODAuMDAgMTYuMDAsODAuMDAgMTYuMDAsODIuNDQgMTUuODcsODUuNzMgMTYuNzQsODguMDAgMjAuNjYsOTguMjIgMzIuMjMsOTcuMDAgNDEuMDAsOTcuMDAgNDEuMDAsOTcuMDAgNjkuMDAsOTcuMDAgNjkuMDAsOTcuMDAgNzYuNjMsOTYuOTkgODIuODEsOTUuODQgODYuMzUsODguMDAgODguNjQsODIuOTQgODguMDAsNzIuNzkgODguMDAsNjcuMDAgODguMDAsNjcuMDAgODguMDAsMjQuMDAgODguMDAsMjQuMDAgODcuOTksMTYuNTEgODcuNzIsMTAuNDIgODAuOTgsNS42NSA3Ni4wNCwyLjE1IDY5LjczLDMuMDAgNjQuMDAsMy4wMCA2NC4wMCwzLjAwIDI3LjAwLDMuNTMgMjcuMDAsMy41MyBaIE0gNjguODksMTUuNzEgQyA3NC4wNCwxNS45NiA3MS45NiwxOS4yMCA3NC4wMSwyMi42OCA3NC4wMSwyMi42OCA3Ni43MiwyNS43NCA3Ni43MiwyNS43NCA4MC45MSwzMC44NSA3NC41MywzMS4wMyA3MS45MiwzNC4yOSA3MC43MCwzNS44MSA3MC4wNSwzOC43MyA2Ny44MSwzOS4wOSA2NS42NCwzOS40MyA2My44MywzNy4wMyA2MS44MywzNi4wMCA1OS4xNCwzNC42MyA1Ni4zMCwzNS4yNCA1NS4wOCwzMy40MCA1My41NiwzMS4xMSA1Ni4xMSwyOC41NSA1Ni4yMCwyNS4wMCA1Ni4yNCwyMy4yOCA1NS4zMiwyMC45NyA1Ni4yMCwxOS4zNSA1Ny42NywxNi42NiA2MC44OSwxOC41MSA2NC4wMCwxNy43MSA2NC4wMCwxNy43MSA2OC44OSwxNS43MSA2OC44OSwxNS43MSBaIE0gNDMuMDYsNDMuODYgQyA0OS44MSw0NS43MSA0OC42NSw1MS40OSA1My4yMSw1My45NCA1Ni4xMyw1NS41MSA1OS41Myw1My41MSA2Mi45NCw1NC40NCA2NC44Myw1NC45NiA2Ni4zMCw1Ni4wNSA2Ni41NCw1OC4xMSA2Ny4xMCw2Mi43NCA2MC44Nyw2Ni4zMSA2MC42OSw3MS4wMCA2MC41Nyw3NC4wMyA2NC45Nyw4MS4yNiA2MS40MCw4My45NiA1Ny42Myw4Ni44MiA1MS4zNiw4MC44MSA0Ny4wMCw4Mi4yMiA0My45Niw4My4yMCA0MC4yMyw4OC4xMSAzNi4xMSw4Ny41NSAyOS43OSw4Ni43MSAzMy45NSw3Ny45OSAzMi40MCw3NC4xOCAzMC43OCw3MC4yMCAyNC42Nyw2OC45NSAyMy4xNyw2NC45NyAyMi4zNCw2Mi43OSAyMy4zOSw2MS4zMCAyNS4xNSw2MC4wOSAyOC4yOSw1Ny45MiAzMi43NCw1OC40OSAzNS40NCw1NS41NyAzOS4xMSw1MS42MCAzNi42MCw0NS43NCA0My4wNiw0My44NiBaXCIgLz5gXHJcblx0XHRhZGRJY29uKCdhbmtpJywgQU5LSV9JQ09OKTtcclxuXHRcdHRoaXMuYWRkUmliYm9uSWNvbignYW5raScsICdTeW5jIE9ic2lkaWFuIHRvIEFua2knLCAoKSA9PiB7XHJcblx0XHRcdHRoaXMuc3luY09ic2lkaWFuVG9BbmtpKCk7XHJcblx0XHR9KTtcclxuXHJcblx0XHQvLyBBZGQgY29tbWFuZCBmb3Igc3luY2luZyBvYnNpZGlhbiB0byBhbmtpXHJcblx0XHR0aGlzLmFkZENvbW1hbmQoe1xyXG5cdFx0XHRpZDogJ3N5bmMtb2JzaWRpYW4tdG8tYW5raScsXHJcblx0XHRcdG5hbWU6ICdTeW5jIE9ic2lkaWFuIHRvIEFua2knLFxyXG5cdFx0XHRjYWxsYmFjazogKCkgPT4ge1xyXG5cdFx0XHRcdHRoaXMuc3luY09ic2lkaWFuVG9BbmtpKCk7XHJcblx0XHRcdH1cclxuXHRcdH0pO1xyXG5cdH1cclxuXHJcblx0b251bmxvYWQoKSB7XHJcblx0XHRjb25zb2xlLmxvZygnVW5sb2FkaW5nIE9ic2lkaWFuQW5raU1ETUwnKTtcclxuXHR9XHJcblxyXG5cdGFzeW5jIHN5bmNPYnNpZGlhblRvQW5raSgpIHtcclxuXHRcdG5ldyBOb3RpY2UoYFN0YXJ0aW5nIE9ic2lkaWFuIHRvIEFua2kgU3luYyBmb3IgdmF1bHQgJHt0aGlzLmFwcC52YXVsdC5nZXROYW1lKCl9Li4uYCk7XHJcblxyXG5cdFx0Ly8gQWRkXHJcblx0XHR2YXIgYWxsQ2xvemVCbG9ja3M6IENsb3plQmxvY2tbXSAgPSBbXTtcclxuXHRcdGZvcih2YXIgZmlsZSBvZiB0aGlzLmFwcC52YXVsdC5nZXRNYXJrZG93bkZpbGVzKCkpIHtcclxuXHRcdFx0YWxsQ2xvemVCbG9ja3MgPSBhbGxDbG96ZUJsb2Nrcy5jb25jYXQoYXdhaXQgcGFyc2VDbG96ZUJsb2NrKHRoaXMuYXBwLnZhdWx0LCBmaWxlKSk7XHJcblx0XHR9XHJcblx0XHRjb25zb2xlLmxvZyhhbGxDbG96ZUJsb2Nrcyk7XHJcblx0XHRmb3IodmFyIGJsb2NrIG9mIGFsbENsb3plQmxvY2tzKSB7XHJcblx0XHRcdGJsb2NrLm1kVG9BbmtpRm9ybWF0KCk7XHJcblx0XHR9XHJcblx0XHRjb25zb2xlLmxvZyhhbGxDbG96ZUJsb2Nrcyk7XHJcblx0XHQvLyBDcmVhdGUgb3IgdXBkYXRlIHRoZSBjYXJkc1xyXG5cclxuXHRcdC8vIERlbGV0ZSB0aGUgZGVsZXRlZCBjYXJkc1xyXG5cdH1cclxufSJdLCJuYW1lcyI6WyJQbHVnaW4iLCJhZGRJY29uIiwiTm90aWNlIl0sIm1hcHBpbmdzIjoiOzs7O01BRXNCLEtBQUs7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
